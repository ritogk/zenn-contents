---
title: "Vue3ã§refã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´ã«refã§ãƒ©ãƒƒãƒ—ã—ãŸã‚‰å‹ãŒå¤‰ã‚ã£ã¦ãƒãƒã£ãŸã€‚"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["vue3", "vue"]
published: true
---

# å•é¡Œ
ã“ã‚“ãªæ„Ÿã˜ã®äº‹ã‚’ã™ã‚‹ã¨threeã®computedå‹ãŒæ¶ˆãˆã¦ã—ã¾ã„ãƒãƒã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚
```tsx
const three = ref(3)
const object = {
  one: 1,
  two: 2,
  three: computed(() => {
    return three.value
  }),
}
const objectRef = ref(object)
objectRef.value = object // ã“ã“ã§å‹ã‚¨ãƒ©ãƒ¼
```

![](/images/8bba521161f3f7/1.png)
![](/images/8bba521161f3f7/2.png)

# ä½œã‚ã†ã¨ã—ãŸç‰©
YouTubeå‹•ç”»ã¨ãƒ­ãƒ¼ã‚«ãƒ«å‹•ç”»ã®åˆ‡ã‚Šæ›¿ãˆã¨å†ç”Ÿãƒ»åœæ­¢ãŒå¯èƒ½ãªæ©Ÿèƒ½ã®å®Ÿè£…ã‚’ã—ã¾ã—ãŸã€‚
![](/images/8bba521161f3f7/1.gif)

ã“ã®ã‚ˆã†ãªæ§‹é€ ã§ã€YouTubeã¨ãƒ­ãƒ¼ã‚«ãƒ«å‹•ç”»ã®æ“ä½œã‚’ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã§å…±é€šåŒ–ã—ã€åˆ©ç”¨å´ã®App.vueã§ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¯ãƒ©ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å½¢ã§å®Ÿè£…ã—ã¾ã—ãŸã€‚

```bash
â”œâ”€â”€ App.vue             // ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ IVideoState.ts      // å‹•ç”»çŠ¶æ…‹ã®interface
â”œâ”€â”€ LocalVideoState.ts  // ãƒ­ãƒ¼ã‚«ãƒ«å‹•ç”»çŠ¶æ…‹
â”œâ”€â”€ YoutubeVideoState.ts// Youtubeå‹•ç”»çŠ¶æ…‹
```

# ã‚³ãƒ¼ãƒ‰
```tsx:IVideoState.ts
import { ComputedRef } from "vue"
export interface IVideoState {
  play(): void
  stop(): void
  subscription: {
    status: ComputedRef<VideoStatus>
    videoType: ComputedRef<VideoType>
  }
}
export enum VideoStatus {
  NOT_CREATED = "æœªä½œæˆ",
  CREATED = "ä½œæˆæ¸ˆ",
  PLAYING = "å†ç”Ÿä¸­",
  STOPED = "åœæ­¢ä¸­",
}
export enum VideoType {
  YOUTUBE = "YOUTUBE",
  LOCAL = "LOCAL",
}
```

:::details LocalVideoState.ts
```tsx:LocalVideoState.ts
import { InjectionKey, ref, computed } from "vue"
import { IVideoState, VideoStatus, VideoType } from "./IVideoState"
// Youtubeã®çŠ¶æ…‹ã‚¯ãƒ©ã‚¹
class UseYoutubeVideoState implements IVideoState {
  private status = ref(VideoStatus.NOT_CREATED)
  constructor() {
	  // ã“ã“ã§Youtubeå‹•ç”»ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã™ã‚‹
    this.status.value = VideoStatus.CREATED
  }
  play = () => {
    this.status.value = VideoStatus.PLAYING
  }
  stop = () => {
    this.status.value = VideoStatus.STOPED
  }
  subscription = {
    status: computed(() => {
      return this.status.value
    }),
    videoType: computed(() => {
      return VideoType.YOUTUBE
    }),
  }
}
const YoutubeVideoStateKey: InjectionKey<IVideoState> = Symbol("YoutubeVideoState")
export { UseYoutubeVideoState, YoutubeVideoStateKey }
```
:::

:::details YoutubeVideoState.ts
```tsx:YoutubeVideoState.ts
import { InjectionKey, ref, computed } from "vue"
import { IVideoState, VideoStatus, VideoType } from "./IVideoState"
// ãƒ­ãƒ¼ã‚«ãƒ«å‹•ç”»
class UseLocalVideoState implements IVideoState {
  private status = ref(VideoStatus.NOT_CREATED)
  constructor() {
	  // ã“ã“ã§ãƒ­ãƒ¼ã‚«ãƒ«å‹•ç”»ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½œæˆã™ã‚‹
    this.status.value = VideoStatus.CREATED
  }
  play = () => {
    this.status.value = VideoStatus.PLAYING
  }
  stop = () => {
    this.status.value = VideoStatus.STOPED
  }
  subscription = {
    status: computed(() => {
      return this.status.value
    }),
    videoType: computed(() => {
      return VideoType.LOCAL
    }),
  }
}
const LocalVideoStateKey: InjectionKey<IVideoState> = Symbol("LocalVideoState")
export { UseLocalVideoState, LocalVideoStateKey }
```
:::


```vue:App.vue
<script setup lang="ts">
import { UseYoutubeVideoState } from "./YoutubeVideoState"
import { UseLocalVideoState } from "./LocalVideoState"
import { ref } from "vue"
const video = ref(new UseYoutubeVideoState())
const hundlePlayClick = () => {
  video.value.play()
}
const hundleStopClick = () => {
  video.value.stop()
}
const hundleVideoChange = () => {
  // >>>> â˜…â˜…â˜…ã“ã“ã§æ€’ã‚‰ã‚Œã‚‹â˜…â˜…â˜… <<<<
  video.value = new UseLocalVideoState()
}
</script>

<template>
  <div style="width: 300px; background: gainsboro">
    <div
      style="
        width: 100%;
        height: 150px;
        background: gray;
        text-align: center;
        color: white;
      "
    >
      {{ video.subscription.videoType.value }}
    </div>
    <p>status: {{ video.subscription.status.value }}</p>
    <button @click="hundlePlayClick()">å†ç”Ÿ</button>
    <button @click="hundleStopClick()">åœæ­¢</button><br />
    <button @click="hundleVideoChange()">å‹•ç”»ã‚’å¤‰æ›´</button>
  </div>
</template>
```

refã§ãƒ©ãƒƒãƒ—ã—ãŸã‚¯ãƒ©ã‚¹ã‚’åŒã˜ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã‚’æŒã¤åˆ¥ã®ã‚¯ãƒ©ã‚¹ã§ç½®ãæ›ãˆã‚ˆã†ã¨ã—ãŸå ´åˆã«ã€å‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
![](/images/8bba521161f3f7/Untitled.png)
subscripitonã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã€ãªãœã‹ç®—å‡ºãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã¯ãªããªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

# ãªãœå‹ãŒå¤‰ã‚ã£ãŸã®ã‹ï¼Ÿ
[å…¬å¼](https://ja.vuejs.org/api/reactivity-core.html#ref)ã«ã“ã‚“ãªä¸€æ–‡ãŒã‚ã‚Šã¾ã™ã€‚

> If an object is assigned as a ref's value, the object is made deeply reactive withÂ **[reactive()](https://vuejs.org/api/reactivity-core.html#reactive)**. This also means if the object contains nested refs, they will be deeply unwrapped.
    
DeepLã§å’Œè¨³ã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã€‚
> ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒrefã®å€¤ã¨ã—ã¦å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå ´åˆã€ãã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯reactive()ã§ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒãƒã‚¹ãƒˆã—ãŸrefã‚’å«ã‚“ã§ã„ã‚‹å ´åˆã€ãã‚Œã‚‰ãŒæ·±ãã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã•ã‚Œã‚‹ã“ã¨ã‚‚æ„å‘³ã—ã¾ã™ã€‚

refã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã¨ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã«å«ã¾ã‚Œã‚‹refãŒè§£é™¤ã•ã‚Œã¦ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ãŒãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã•ã‚Œã¦ã—ã¾ã†ã‚‰ã—ã„ã€‚
å…¨ä½“ã‚’ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã›ãšã«video.valueã®ã¿ã‚’ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–ã™ã‚‹ã«ã¯ã€[shallowRef](https://ja.vuejs.org/api/reactivity-advanced.html#shallowref)ã‚’ä½¿ãˆã¨ã®äº‹ã€‚

ãªã®ã§shallowRefã‚’ä½¿ç”¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚
```diff
import { UseLocalVideoState } from "./LocalVideoState"
import { ref } from "vue"
- const video = ref(new UseYoutubeVideoState())
+ const video = shallowRef<IVideoState>(new UseYoutubeVideoState())
``` 

ã“ã‚Œã§OKã€‚

# ãŠã‚ã‚Šã«
é›°å›²æ°—ã§refã‚’ä½¿ã£ã¦ã„ãŸã›ã„ã§ãƒãƒã£ã¦ã—ã¾ã„ã¾ã—ãŸãƒ»ãƒ»ãƒ»ãƒ»ãƒ»
çš†ã•ã‚“ã‚‚å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã¡ã‚ƒã‚“ã¨èª­ã¿ã¾ã—ã‚‡ã†ã€‚
